<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover, user-scalable=no, shrink-to-fit=no" />
    <meta name="HandheldFriendly" content="true">
    <title>Tilt Circle App</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: white;
            font-family: Arial, sans-serif;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }
        
        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        #permission-panel {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            padding: 20px;
            max-width: 300px;
        }
        
        #start-button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 15px;
        }
        
        #start-button:hover {
            background: #0051D5;
        }
        
        #canvas-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        #crosshairs {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            pointer-events: none;
        }
        
        .crosshair-line {
            position: absolute;
            background: #333;
        }
        
        .horizontal {
            top: 50%;
            left: 0;
            width: 100%;
            height: 2px;
            transform: translateY(-50%);
        }
        
        .vertical {
            top: 0;
            left: 50%;
            width: 2px;
            height: 100%;
            transform: translateX(-50%);
        }
        
        #circle {
            position: absolute;
            width: 40px;
            height: 40px;
            background: #007AFF;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: transform 0.1s ease-out;
        }
        
        .warning {
            color: #ff4444;
            margin-top: 20px;
            display: none;
        }
        
        .values-display {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            font-family: monospace;
            display: none;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="permission-panel">
            <h2>Tilt Circle App</h2>
            <p>This app uses your device's motion sensors to control a circle. Tilt your device to move the circle around!</p>
            <button id="start-button">Enable Motion Access</button>
            <div class="warning" id="warning">
                Device motion is not available on this device or browser.
            </div>
        </div>
        
        <div id="canvas-container" style="display: none;">
            <div id="crosshairs">
                <div class="crosshair-line horizontal"></div>
                <div class="crosshair-line vertical"></div>
            </div>
            <div id="circle"></div>
            <div class="values-display" id="values">
                <div>Alpha: <span id="alpha">0</span>째</div>
                <div>Beta: <span id="beta">0</span>째</div>
                <div>Gamma: <span id="gamma">0</span>째</div>
                <div>Compass: <span id="compass">0</span>째</div>
            </div>
        </div>
    </div>

    <script>
        let isMotionEnabled = false;
        let maxRadius = 120; // Maximum distance circle can move from center
        let currentX = 0;
        let currentY = 0;
        let falloffRate = 0.85; // How quickly the circle returns to center
        
        // Get DOM elements
        const permissionPanel = document.getElementById('permission-panel');
        const canvasContainer = document.getElementById('canvas-container');
        const startButton = document.getElementById('start-button');
        const warning = document.getElementById('warning');
        const circle = document.getElementById('circle');
        const valuesDisplay = document.getElementById('values');
        
        // Check if we're on a mobile device or mobile-sized screen
        function isMobileDevice() {
            return window.innerWidth <= 768 || /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }
        
        // Initialize the app
        function init() {
            if (!isMobileDevice()) {
                warning.textContent = "This app is designed for mobile devices. Please visit on a mobile device or resize your browser window.";
                warning.style.display = 'block';
                return;
            }
            
            // Check if DeviceOrientationEvent is available
            if (typeof DeviceOrientationEvent === 'undefined') {
                warning.style.display = 'block';
                return;
            }
            
            // Check if we need permission (iOS 13+)
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                startButton.addEventListener('click', requestPermission);
            } else {
                // For other devices, try to start directly
                startButton.addEventListener('click', startMotionTracking);
            }
        }
        
        // Request permission for iOS devices
        async function requestPermission() {
            try {
                const permission = await DeviceOrientationEvent.requestPermission();
                if (permission === 'granted') {
                    startMotionTracking();
                } else {
                    warning.textContent = "Motion permission denied. Please reload and grant permission.";
                    warning.style.display = 'block';
                }
            } catch (error) {
                console.error('Error requesting permission:', error);
                startMotionTracking(); // Try anyway for non-iOS devices
            }
        }
        
        // Start tracking device motion
        function startMotionTracking() {
            isMotionEnabled = true;
            permissionPanel.style.display = 'none';
            canvasContainer.style.display = 'block';
            valuesDisplay.style.display = 'block';
            
            // Add event listener for device orientation
            window.addEventListener('deviceorientation', handleOrientation);
            
            // Start the animation loop
            animate();
        }
        
        // Handle device orientation changes
        function handleOrientation(event) {
            const alpha = event.alpha || 0; // Z axis rotation (compass)
            const beta = event.beta || 0;   // X axis rotation (front-back tilt)
            const gamma = event.gamma || 0; // Y axis rotation (left-right tilt)
            
            // Get compass heading (iOS specific)
            const compass = event.webkitCompassHeading || alpha;
            
            // Update display values
            document.getElementById('alpha').textContent = alpha.toFixed(1);
            document.getElementById('beta').textContent = beta.toFixed(1);
            document.getElementById('gamma').textContent = gamma.toFixed(1);
            document.getElementById('compass').textContent = compass.toFixed(1);
            
            // Calculate circle position based on device tilt
            // Beta controls Y movement (forward/back tilt)
            // Gamma controls X movement (left/right tilt)
            
            // Normalize the tilt values and apply to circle position
            // Beta range: -180 to 180, but useful range is roughly -45 to 45
            // Gamma range: -90 to 90
            
            const normalizedX = Math.max(-1, Math.min(1, gamma / 45));
            const normalizedY = Math.max(-1, Math.min(1, beta / 45));
            
            // Apply movement with falloff
            currentX += normalizedX * 2;
            currentY += normalizedY * 2;
            
            // Apply falloff (return to center)
            currentX *= falloffRate;
            currentY *= falloffRate;
            
            // Limit to maximum radius
            const distance = Math.sqrt(currentX * currentX + currentY * currentY);
            if (distance > maxRadius) {
                const scale = maxRadius / distance;
                currentX *= scale;
                currentY *= scale;
            }
        }
        
        // Animation loop
        function animate() {
            if (isMotionEnabled) {
                // Update circle position
                circle.style.transform = `translate(calc(-50% + ${currentX}px), calc(-50% + ${currentY}px))`;
                requestAnimationFrame(animate);
            }
        }
        
        // Initialize when page loads
        window.addEventListener('load', init);
        
        // Handle window resize
        window.addEventListener('resize', () => {
            if (!isMobileDevice() && isMotionEnabled) {
                // Optionally handle resize for mobile devices in landscape/portrait
                const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
                const vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);
                maxRadius = Math.min(vw, vh) / 4; // Adjust max radius based on screen size
            }
        });
    </script>
</body>
</html>